# Context

## å…¨å±€èµ„æºè®¿é—®

**å…¨å±€èµ„æºè®¿é—®**ï¼š`Context` å…è®¸è®¿é—®åº”ç”¨çš„èµ„æºï¼Œå¦‚å­—ç¬¦ä¸²ã€é¢œè‰²ã€å¸ƒå±€ç­‰ã€‚

`Activity`ç±»æ˜¯`Context`çš„ä¸€ä¸ªå­ç±»ï¼Œç›´æ¥åœ¨`Activity`ä¸­ä½¿ç”¨`this`æ¥è·å–`Context`ã€‚

![image-20240726102145002](https://raw.githubusercontent.com/betteryuxuan/Image/main/image-20240726102145002.png)

```java
TextView tv = new TextView(this);
tv.setText(R.string.app_name);
setContentView(tv);
```

`this` ä½œä¸º `Context` ä¼ å…¥ `TextView` çš„æ„é€ å‡½æ•°ä¸­ã€‚è¿™è®© `TextView` èƒ½å¤Ÿè®¿é—®åˆ°åº”ç”¨çš„èµ„æºå’Œç³»ç»ŸæœåŠ¡ã€‚

`R.string.app_name` æ˜¯åº”ç”¨èµ„æºä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²èµ„æºID

åœ¨è¿™é‡Œï¼Œé€šè¿‡ `Context` è®¿é—®åˆ°äº† `R.string.app_name`æ¥è®¾ç½®çš„ã€‚

# ç”Ÿå‘½å‘¨æœŸ

`oncreate onStart onResume onPause onStop onDestory onRestart`

> onAttach **onCreate** onCreateView onViewCreated onActivityCreated **onStart**  **onResume** 
>
> **onPause** **onStop** onDestoryView **onDestory** onDetach`

# å›¾ç‰‡

![image-20240806095511923](https://raw.githubusercontent.com/betteryuxuan/Image/main/image-20240806095511923.png)

# å›è°ƒ

> Aè°ƒç”¨Bä¸­çš„æ–¹æ³•bï¼Œéœ€è¦ä¼ å…¥Aè‡ªèº«å¼•ç”¨ï¼Œæ–¹æ³•bæ‰§è¡Œå®Œæ¯•åï¼Œå†åˆ©ç”¨ä¼ å…¥çš„Açš„å¼•ç”¨ï¼Œå›è°ƒç”¨Aä¸­çš„å®ç°çš„æ¥å£æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°å¼‚æ­¥ä¿®æ”¹Aæ•°æ®çš„æ•ˆæœ

# æƒé™

> 1. åœ¨`AndroidManifest.xml`è¿›è¡Œæƒé™å£°æ˜
> 2. åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹æƒé™è¿›è¡Œè¯·æ±‚
> 3. åˆ¤æ–­æƒé™çš„è¯·æ±‚ç»“æœ

```java
<!-- è¿è¡ŒAndroid 12Lï¼ˆAPI 32çº§ï¼‰æˆ–æ›´ä½ç‰ˆæœ¬çš„è®¾å¤‡  -->
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"
        android:maxSdkVersion="32" />

<!--è¿è¡ŒAndroid 13ï¼ˆAPI 33çº§ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡-->
<uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
<uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />

<!--åœ¨Android 14ï¼ˆAPI 34çº§ï¼‰ä¸Šå¤„ç†åº”ç”¨ç¨‹åºå†…çš„é‡æ–°é€‰æ‹©-->
<uses-permission android:name="android.permission.READ_MEDIA_VISUAL_USER_SELECTED" />
```

# ä¸Šä¼ ç…§ç‰‡

```java
```

```java
 @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = mLayoutInflater.inflate(R.layout.list_item_layout, parent, false);
        MyViewHolder myViewHolder = new MyViewHolder(view);
        return myViewHolder;
    }
```

åœ¨ä½¿ç”¨`RecyclerView`æ—¶æ„å»º`ViewHolder`æ—¶ï¼Œä½¿ç”¨åˆ°äº†`inflate`æ–¹æ³•ã€‚è¿™é‡Œå°±æ˜¯æŠŠæˆ‘ä»¬çš„`list_item_layout`å¸ƒå±€æ–‡ä»¶å˜æˆä¸€ä¸ª`View`å¯¹è±¡ï¼Œç„¶åå¾—åˆ°é‡Œé¢çš„æ§ä»¶ï¼Œç±»ä¼¼äº`findViewById`

å­¦ä¹ è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæœ‰è¿™å‡ ä¸ªé—®é¢˜

1. `mLayoutInflater`æ˜¯å“ªæ¥çš„ï¼Œå¹²ä»€ä¹ˆçš„

é€šè¿‡`LayoutInflater.from(context);`è·å–å®ä¾‹ï¼Œç›®çš„æ˜¯æ¥ä¸‹æ¥å°† XML å¸ƒå±€æ–‡ä»¶è§£ææˆç›¸åº”çš„è§†å›¾å¯¹è±¡

2. `inflate`å‚æ•°éƒ½ä»€ä¹ˆæ„æ€

* **`int resource`**ï¼š

  - è¿™ä¸ªå‚æ•°è¡¨ç¤ºè¦åŠ è½½çš„ XML å¸ƒå±€èµ„æºçš„ ID

* **`ViewGroup root`**ï¼š

  * è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œè¡¨ç¤ºä½ æƒ³è¦åŠ è½½çš„å¸ƒå±€æ–‡ä»¶çš„æ ¹è§†å›¾çš„çˆ¶è§†å›¾ã€‚ä¾‹å¦‚ï¼Œåœ¨ `RecyclerView.Adapter` ä¸­ï¼Œè¿™é€šå¸¸æ˜¯ `parent` å‚æ•°ã€‚
  * ä¸»è¦ä½œç”¨æ˜¯æä¾›å¸ƒå±€å‚æ•°ï¼ˆå¦‚å®½åº¦å’Œé«˜åº¦ï¼‰ç»™åŠ è½½çš„å¸ƒå±€æ–‡ä»¶ã€‚å¦‚æœä¼ å…¥çš„ `root` ä¸º `null`ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ä»»ä½•çˆ¶è§†å›¾çš„å¸ƒå±€å‚æ•°ã€‚

* **`boolean attachToRoot`**:

  è¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå†³å®šåŠ è½½çš„è§†å›¾æ˜¯å¦åº”è¯¥è¢«ç«‹å³æ·»åŠ åˆ°`root`ä¸­ã€‚

  - å¦‚æœä¸º `true`ï¼Œåˆ™åŠ è½½çš„è§†å›¾ä¼šè¢«æ·»åŠ åˆ° `root` ä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨ `root` çš„å¸ƒå±€å‚æ•°ã€‚
  - å¦‚æœä¸º `false`ï¼ŒåŠ è½½çš„è§†å›¾ä¸ä¼šè¢«æ·»åŠ åˆ° `root` ä¸­ï¼Œä½† `root` çš„å¸ƒå±€å‚æ•°ä»ç„¶ä¼šè¢«ä½¿ç”¨ã€‚

>  rootï¼=nullï¼š
>
>  1. attachToRoot==trueï¼šæŠŠè¦åŠ è¿›å»çš„å¸ƒå±€è¿å¸¦çˆ¶å¸ƒå±€ç›´æ¥addView
>  2. attachToRoot==falseï¼šè¿”å›è¦åŠ è¿›å»çš„å¸ƒå±€è¿å¸¦çˆ¶å¸ƒå±€ï¼Œä¸addView
>
>  root==nullï¼š
>
>  1. attachToRootå€¼æ— ä½œç”¨äº†ï¼Œåªä¼šæŠŠè¦åŠ è¿›å»çš„å¸ƒå±€ä¸å¸¦çˆ¶å¸ƒå±€å‚æ•°ï¼Œä¸addView

# LayoutInflater

## è·å–å®ä¾‹çš„æ–¹æ³•

<u>ä¸èƒ½newå‡ºæ¥</u>

1. ä½¿ç”¨ `Activity` çš„ `getLayoutInflater()` æ–¹æ³•

åœ¨ `Activity` ä¸­ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ `getLayoutInflater()` æ–¹æ³•æ¥è·å– `LayoutInflater` å®ä¾‹ï¼š

```java
LayoutInflater inflater = getLayoutInflater();
```

2. é€šè¿‡ `Context` çš„ `getSystemService()` æ–¹æ³•

æ— è®ºæ˜¯åœ¨ `Activity`ã€`Fragment` è¿˜æ˜¯å…¶ä»–ç±»ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡ `Context` çš„ `getSystemService()` æ–¹æ³•è·å– `LayoutInflater` å®ä¾‹ï¼š

```java
LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
```

3. ä½¿ç”¨ `LayoutInflater.from()` æ–¹æ³•

è¿™æ˜¯å¦ä¸€ç§é€šè¿‡ `Context` è·å– `LayoutInflater` å®ä¾‹çš„ä¾¿æ·æ–¹æ³•ï¼š

```java
LayoutInflater inflater = LayoutInflater.from(context);
```

## inflateæ–¹æ³•åˆ†æ

![image-20240723232400433](https://raw.githubusercontent.com/betteryuxuan/Image/main/image-20240723232400433.png)

```java
LayoutInflater inflater = LayoutInflater.from(context);
View view = inflater.inflate(R.layout.list_item, null);
// æ‰‹åŠ¨æ·»åŠ åˆ°çˆ¶è§†å›¾
parent.addView(view);
```

å¦‚æœæ²¡æœ‰æä¾› `attachToRoot` å‚æ•°ï¼Œ `root` ä¸º`null`

``inflate` æ–¹æ³•å°†è¿”å›ä¸€ä¸ªç‹¬ç«‹çš„è§†å›¾ï¼Œæ²¡æœ‰çˆ¶è§†å›¾

è¿™é‡Œçš„`ViewGroup parent` æ˜¯å½“å‰ `RecyclerView` çš„çˆ¶è§†å›¾ï¼Œè¡¨ç¤ºå½“å‰é¡¹çš„å®¹å™¨

## è¿”å›å€¼å¯¹è±¡ç”¨å¤„

è¿”å›çš„ `View` å¯¹è±¡æ˜¯é€šè¿‡ `LayoutInflater` çš„ `inflate` æ–¹æ³•åˆ›å»ºçš„ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªç”± XML å¸ƒå±€æ–‡ä»¶å®šä¹‰çš„è§†å›¾ã€‚è¿™ä¸ª `View` å¯¹è±¡å¯ä»¥ç”¨äºå¤šç§ç”¨é€”ï¼ŒåŒ…æ‹¬æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ã€æ“ä½œå…¶å­è§†å›¾ã€åŠ¨æ€æ›´æ–°å†…å®¹ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç”¨é€”å’Œç¤ºä¾‹ï¼š

1. æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„

ä½ å¯ä»¥å°†è¿”å›çš„ `View` å¯¹è±¡æ·»åŠ åˆ°ç°æœ‰çš„è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ï¼ŒåŠ¨æ€æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šã€‚

```java
LayoutInflater inflater = LayoutInflater.from(context);
View view = inflater.inflate(R.layout.list_item, null);

// è·å–çˆ¶è§†å›¾ï¼ˆä¾‹å¦‚ä¸€ä¸ªå¸ƒå±€å®¹å™¨ï¼‰
ViewGroup parent = findViewById(R.id.parent_layout);

// å°†åŠ¨æ€åŠ è½½çš„è§†å›¾æ·»åŠ åˆ°çˆ¶è§†å›¾ä¸­
parent.addView(view);
```

2. æ“ä½œå­è§†å›¾

è¿”å›çš„ `View` å¯¹è±¡åŒ…å«äº†é€šè¿‡ XML æ–‡ä»¶å®šä¹‰çš„æ‰€æœ‰å­è§†å›¾ã€‚ä½ å¯ä»¥é€šè¿‡ `findViewById` æ–¹æ³•æ¥è®¿é—®å’Œæ“ä½œè¿™äº›å­è§†å›¾ï¼Œä¾‹å¦‚è®¾ç½®æ–‡æœ¬ã€å›¾åƒã€ç›‘å¬äº‹ä»¶ç­‰ã€‚

```java
// åŠ¨æ€åŠ è½½å¸ƒå±€æ–‡ä»¶
View view = inflater.inflate(R.layout.list_item, null);

// è·å–å­è§†å›¾å¹¶è®¾ç½®å±æ€§
TextView textView = view.findViewById(R.id.item_text);
textView.setText("è¿™æ˜¯åŠ¨æ€åŠ è½½çš„è§†å›¾");

// è·å– ImageView å¹¶è®¾ç½®å›¾ç‰‡
ImageView imageView = view.findViewById(R.id.item_image);
imageView.setImageResource(R.drawable.example_image);
```

3. åœ¨ `RecyclerView.Adapter` ä¸­ä½¿ç”¨

åœ¨ `RecyclerView.Adapter` ä¸­ï¼Œè¿”å›çš„ `View` å¯¹è±¡é€šå¸¸ç”¨äºåˆ›å»ºå’Œç»‘å®šè§†å›¾ã€‚ä½ å¯ä»¥é€šè¿‡ `onCreateViewHolder` æ–¹æ³•åˆ›å»ºè§†å›¾ï¼Œå¹¶åœ¨ `onBindViewHolder` æ–¹æ³•ä¸­ç»‘å®šæ•°æ®ã€‚

```java
public class MyAdapter extends RecyclerView.Adapter<MyAdapter.MyViewHolder> {

    private List<String> mData;
    private LayoutInflater mLayoutInflater;

    // æ„é€ å‡½æ•°ï¼Œç”¨äºä¼ å…¥æ•°æ®å’Œä¸Šä¸‹æ–‡
    MyAdapter(Context context, List<String> data) {
        this.mData = data;
        this.mLayoutInflater = LayoutInflater.from(context);
    }

    // åˆ›å»ºæ–°çš„è§†å›¾ï¼ˆç”±å¸ƒå±€ç®¡ç†å™¨è°ƒç”¨ï¼‰
    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = mLayoutInflater.inflate(R.layout.list_item, parent, false);
        return new MyViewHolder(view);
    }

    // ç»‘å®šæ•°æ®åˆ°è§†å›¾ä¸Šï¼ˆç”±å¸ƒå±€ç®¡ç†å™¨è°ƒç”¨ï¼‰
    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
        String item = mData.get(position);
        holder.myTextView.setText(item);
    }

    // è·å–æ•°æ®é›†çš„æ€»æ•°
    @Override
    public int getItemCount() {
        return mData.size();
    }

    // è‡ªå®šä¹‰çš„ ViewHolder ç±»
    public static class MyViewHolder extends RecyclerView.ViewHolder {
        TextView myTextView;

        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            myTextView = itemView.findViewById(R.id.item_text);
        }
    }
}
```

4. åœ¨ `Activity` æˆ– `Fragment` ä¸­ä½¿ç”¨

åœ¨ `Activity` æˆ– `Fragment` ä¸­ï¼Œä½ å¯ä»¥åŠ¨æ€åŠ è½½è§†å›¾å¹¶å°†å…¶æ·»åŠ åˆ°ç°æœ‰å¸ƒå±€ä¸­ï¼Œæˆ–è€…ç”¨äºå¤„ç†ç”¨æˆ·äº¤äº’ã€‚

```java
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        LayoutInflater inflater = LayoutInflater.from(this);
        View view = inflater.inflate(R.layout.list_item, null);

        // è·å–æ ¹å¸ƒå±€
        LinearLayout rootLayout = findViewById(R.id.root_layout);
        
        // å°†åŠ¨æ€åŠ è½½çš„è§†å›¾æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­
        rootLayout.addView(view);

        // æ“ä½œè§†å›¾
        TextView textView = view.findViewById(R.id.item_text);
        textView.setText("è¿™æ˜¯åŠ¨æ€åŠ è½½çš„è§†å›¾");
    }
}
```

5. ä½¿ç”¨ `View` å¯¹è±¡å¤„ç†äº‹ä»¶

ä½ å¯ä»¥è®¾ç½®äº‹ä»¶ç›‘å¬å™¨æ¥å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€é•¿æŒ‰äº‹ä»¶ç­‰ã€‚

```java
// åŠ¨æ€åŠ è½½å¸ƒå±€æ–‡ä»¶
View view = inflater.inflate(R.layout.list_item, null);

// è·å–æŒ‰é’®å¹¶è®¾ç½®ç‚¹å‡»äº‹ä»¶
Button button = view.findViewById(R.id.item_button);
button.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        // å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        Toast.makeText(context, "æŒ‰é’®è¢«ç‚¹å‡»", Toast.LENGTH_SHORT).show();
    }
});
```

**æ€»ç»“**

1. **æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„**: å°†è§†å›¾åŠ¨æ€æ·»åŠ åˆ°ç°æœ‰çš„è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ã€‚
2. **æ“ä½œå­è§†å›¾**: è®¿é—®å’Œä¿®æ”¹è§†å›¾ä¸­çš„å­è§†å›¾ã€‚
3. **åœ¨ `RecyclerView.Adapter` ä¸­ä½¿ç”¨**: åŠ¨æ€åˆ›å»ºå’Œç»‘å®šåˆ—è¡¨é¡¹è§†å›¾ã€‚
4. **åœ¨ `Activity` æˆ– `Fragment` ä¸­ä½¿ç”¨**: åŠ¨æ€åŠ è½½å’Œç®¡ç†è§†å›¾ã€‚
5. **å¤„ç†äº‹ä»¶**: è®¾ç½®äº‹ä»¶ç›‘å¬å™¨å¤„ç†ç”¨æˆ·äº¤äº’ã€‚

# ç…§ç‰‡å¤„ç†

## å®‰å“åŸç”Ÿ

```java
private ActivityResultLauncher<PickVisualMediaRequest> pickMedia = registerForActivityResult(new ActivityResultContracts.PickVisualMedia(), uri -> {
    if (uri != null) {
        binding.imgInfoPhoto.setImageURI(uri);
        mPresenter.saveUserAvatar(uri);
        // è·å– ContentResolver å®ä¾‹
        ContentResolver contentResolver = getApplicationContext().getContentResolver();

        // æŒä¹…åŒ–URIè®¿é—®æƒé™
        contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION);
    }
});

```

```java
private void launchImagePicker() {
    pickMedia.launch(new PickVisualMediaRequest.Builder()
            .setMediaType(ActivityResultContracts.PickVisualMedia.ImageOnly.INSTANCE)
            .build());
}
```

## ImagePicker

[Dhaval2404/ImagePicker: ğŸ“¸Image Picker for Android, Pick an image from Gallery or Capture a new image with Camera](https://github.com/Dhaval2404/ImagePicker)

